<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/globals/index.css">
    <link rel="stylesheet" href="css/pages/index.css">
    <link rel="stylesheet" href="./modal.css">
    <title>–ß–∏—Å—Ç—ã–π –î–æ–º | –ù–∞—à–∏ —É—Å–ª—É–≥–∏</title>
</head>
<body>
    <div class="wrapper">
        <header class="header">
            <div class="header__container">
                <div class="header__logobox">
                <a href="index.html"><img class="header__logo" src="images/header/5880208.png"></a>
                <h2 class="header__title">–ß–∏—Å—Ç—ã–π –¥–æ–º</h2>
                </div>
                <nav class="header__menu menu">
                    <ul class="menu__list">
                        <li class="menu__item"><a href="index.html" class="menu__link">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li class="menu__item"><a href="take_order.html" class="menu__link">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</a></li>
                        <li class="menu__item"><a href="service.html" class="menu__link">–£—Å–ª—É–≥–∏</a></li>
                        <li class="menu__item"><a href="#" class="menu__link">–í—Ö–æ–¥</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <main class="main">
            <section class="ser">
                <h2 class="ser__title">–ù–∞—à–∏ —É—Å–ª—É–≥–∏</h2>
                <div class="ser__container">
                    <div class="ser__block">
                        <div class="ser__item">
                            <img src="images/services/flats.png" class="ser__img" alt="flats">
                            <h3 class="ser__itemtitle">–£–±–æ—Ä–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä</h3>
                            <p class="ser__text">3000 ‚ÇΩ</p>
                        </div>

                        <div class="ser__item">
                            <img src="images/services/office.png" class="ser__img" alt="office">
                            <h3 class="ser__itemtitle">–£–±–æ—Ä–∫–∞ –æ—Ñ–∏—Å–æ–≤</h3>
                            <p class="ser__text">4000 ‚ÇΩ</p>
                        </div>

                        <div class="ser__item">
                            <img src="images/services/general.png" class="ser__img" alt="general">
                            <h3 class="ser__itemtitle">–ì–µ–Ω–µ—Ä–∞–ª—å–Ω–∞—è —É–±–æ—Ä–∫–∞</h3>
                            <p class="ser__text">5000 ‚ÇΩ</p>
                            </div>
                        </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div class="footer__container">
                <section id="contact">
                    <div class="contact__container">
                        <h2 class="contact__title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
                        <p class="contact__phone">–ü–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞–º: <a href="tel:+79001231231" class="contact__link">+7 (900) 123-12-31</a></p>
                        <p class="contact__email">–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º: <a href="mailto:info@—á–∏—Å—Ç—ã–π–¥–æ–º.—Ä—Ñ" class="contact__link">info@—á–∏—Å—Ç—ã–π–¥–æ–º.—Ä—Ñ</a></p>
                    </div>
                </section>

                <section class="rights">
                    <div class="rights__container">
                        <p class="rights__text">&copy; 2024 –ß–∏—Å—Ç—ã–π –î–æ–º. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
                    </div>
                </section>
            </div>
        </footer>
    </div>

    
                <div class="modal" id="authModal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>

                <div class="login-header">
                    <div class="icon">üîê</div>
                    <h2 id="form-title">Log in to your account</h2>
                    <p id="form-subtitle">Welcome back! Please enter your details.</p>
                </div>

                <form id="authForm">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="Enter your email" required>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>

                    <div class="form-group" id="passwordConfirmGroup" style="display: none;"  >
                        <label>Password confirmation</label>
                        <input type="password" id="passwordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>

                    <div class="options">
                        <label><input type="checkbox" id="showPass"> Show password</label>
                        <a href="#">Forgot password</a>
                    </div>

                    <button type="submit" class="btn-confirm" id="mainBtn">Login</button>
                    <button type="button" class="btn-cancel">Cancel</button>
                </form>

                <div class="switch">
                    <span id="switchText">Don't have an account? <a id="switchLink">Register</a></span>
                </div>
            </div>
        </div>
        <script>
            const form = document.getElementById("authForm");
            const emailInput = document.getElementById("email");
            const passwordInput = document.getElementById("password");
            const showPass = document.getElementById("showPass");
            const passwordConfirmInput = document.getElementById("passwordConfirm");
            const passwordConfirmGroup = document.getElementById("passwordConfirmGroup");
            const formTitle = document.getElementById("form-title");
            const formSubtitle = document.getElementById("form-subtitle");
            const mainBtn = document.getElementById("mainBtn");
            const switchText = document.getElementById("switchText");

            let isLogin = true;

            showPass.addEventListener("change", () => {
                passwordInput.type = showPass.checked ? "text" : "password";
                passwordConfirmInput.type = showPass.checked ? "text" : "password";
            });

            function setFormMode(loginMode) {
                isLogin = loginMode;
                if (isLogin) {
                    formTitle.textContent = "Log in to your account";
                    formSubtitle.textContent = "Welcome back! Please enter your details.";
                    mainBtn.textContent = "Login";
                    switchText.innerHTML = `Don't have an account? <a id="switchLink">Register</a>`;
                    passwordConfirmGroup.style.display = "none";
                } else {
                    formTitle.textContent = "Create an account";
                    formSubtitle.textContent = "Please enter your details to register.";
                    mainBtn.textContent = "Register";
                    switchText.innerHTML = `Already have an account? <a id="switchLink">Login</a>`;
                    passwordConfirmGroup.style.display = "flex";
                }
                attachSwitchLink();
            }

            function attachSwitchLink() {
                const switchLink = document.getElementById("switchLink");
                if (switchLink) {
                    switchLink.addEventListener("click", (e) => {
                        e.preventDefault();
                        setFormMode(!isLogin);
                    });
                }
            }

            attachSwitchLink();
            setFormMode(true);

            form.addEventListener("submit", async (e) => {
                e.preventDefault();
                const emailValue = emailInput.value.trim();
                const passwordValue = passwordInput.value.trim();
                const passwordConfirmValue = passwordConfirmInput.value.trim();

                if (!emailValue || !passwordValue || (!isLogin && !passwordConfirmValue)) {
                    alert("‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
                    return;
                }

                if (!isLogin && passwordValue !== passwordConfirmValue) {
                    alert("‚ö†Ô∏è –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç");
                    return;
                }

                if (isLogin) {
                    try {
                        let response = await fetch("http://92.255.79.122:9998/api/v1/auth/login", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                login_or_email: emailValue,
                                password: passwordValue,
                            }),
                        });

                        let result = await response.json();
                        console.log(result);

                        if (response.ok) {
                            alert("‚úÖ Login successful!");
                            localStorage.setItem("access_token", result.access_token);
                            window.location.href = "index.html";
                        } else {
                            alert("‚ùå " + (result.message || "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"));
                        }
                    } catch (error) {
                        console.error(error);
                        alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
                    }
                } else {
                    try {
                        let response = await fetch("http://92.255.79.122:9998/api/v1/auth/register", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                login: emailValue.split("@")[0],
                                email: emailValue,
                                password: passwordValue,
                            }),
                        });

                        let result = await response.json();
                        console.log(result);

                        if (response.ok) {
                            alert("üéâ Registration successful! Now you can log in.");
                            setFormMode(true);
                        } else {
                            alert("‚ùå " + (result.message || "–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"));
                        }
                    } catch (error) {
                        console.error(error);
                        alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
                    }
                }
            });

            const modal = document.getElementById("authModal");
            const closeBtn = document.querySelector(".close-btn");
            const cancelBtn = document.querySelector(".btn-cancel");

            document.querySelectorAll(".menu__link").forEach(link => {
                if (link.textContent.trim() === "–í—Ö–æ–¥") {
                    link.addEventListener("click", (e) => {
                        e.preventDefault();
                        modal.style.display = "flex";
                    });
                }
            });

            closeBtn.addEventListener("click", () => modal.style.display = "none");
            cancelBtn.addEventListener("click", () => modal.style.display = "none");

            window.addEventListener("click", (e) => {
                if (e.target === modal) {
                    modal.style.display = "none";
                }
            });
        </script>
</body>
</html>
